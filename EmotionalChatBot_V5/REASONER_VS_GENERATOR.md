# Reasoner vs Generator：思考与生成的分离

## 🎯 核心区别

### Reasoner（思考者）- "想什么"
**作用**：进行**内心独白**，分析用户意图和情绪，制定回复策略

**输出**：`deep_reasoning_trace`（思考内容，**不输出给用户**）

**示例输出**：
```
"用户今天心情不好，想找人倾诉。我应该表现出共情，但不要过度安慰，给他一个倾诉的空间。"
```

### Generator（生成者）- "说什么"
**作用**：根据思考结果，**实际生成回复文本**

**输入**：使用 reasoner 的思考、style 分析、intuition 等

**输出**：`draft_response`（**实际回复文本**，用户会看到）

**示例输出**：
```
"听起来你今天确实不太好受。想聊聊发生了什么吗？我在这听着。"
```

## 🔄 工作流程

```
用户输入："今天心情不太好，想和你聊聊"
    ↓
Detection（感知）："这是正常的倾诉需求"
    ↓
Monitor（监控）：选择心理模式
    ↓
Thinking（并行思考）：
    ├─ Reasoner（思考者）
    │   └─ 输出：deep_reasoning_trace
    │       "用户需要情绪支持，我应该共情但不过度，给他倾诉空间"
    │
    └─ Style（风格分析）
        └─ 输出：style_analysis
            "自然、友好、适度共情"
    ↓
Generator（生成者）
    └─ 输入：
        - 用户消息
        - 记忆
        - intuition_thought（直觉）
        - deep_reasoning_trace（思考）← 来自 Reasoner
        - style_analysis（风格）← 来自 Style
    └─ 输出：draft_response
        "听起来你今天确实不太好受。想聊聊发生了什么吗？我在这听着。"
    ↓
Critic（质检）：检查回复质量
    ↓
Processor（处理）：分段、延迟等
    ↓
Evolver（演化）：更新关系状态
```

## 📊 对比表

| 维度 | Reasoner（思考者） | Generator（生成者） |
|------|-------------------|-------------------|
| **职责** | 分析、思考、制定策略 | 生成实际回复文本 |
| **输出对象** | 内部使用（不输出给用户） | 用户会看到 |
| **输出字段** | `deep_reasoning_trace` | `draft_response` |
| **Prompt 类型** | "请用 1-3 句话写出 Bot 此刻的内心思考" | "请直接输出一条回复" |
| **位置** | Thinking 节点（并行） | Thinking 之后 |
| **是否可见** | ❌ 用户看不到 | ✅ 用户会看到 |

## 💡 为什么这样设计？

### 1. **思考与表达分离**
- **Reasoner**：负责"想什么"（策略层）
- **Generator**：负责"怎么说"（表达层）

这就像人类：
- 先在心里想："他需要安慰，但不要过度"
- 然后组织语言："听起来你今天确实不太好受..."

### 2. **可复用性**
- Reasoner 的思考结果可以被：
  - Generator 使用（生成回复）
  - Critic 使用（质检时参考）
  - 未来可能被其他节点使用

### 3. **可调试性**
- 可以单独查看 `deep_reasoning_trace`，了解 Bot 的思考过程
- 如果回复有问题，可以检查是"思考错了"还是"表达错了"

## 🔍 代码示例

### Reasoner 的 Prompt
```python
prompt = f"""【内心独白指令】{instruction}

用户最后一条消息：
{user_content}

请用 1-3 句话写出 Bot 此刻的内心思考（不输出给用户）。"""
```

**输出示例**：
```json
{
  "deep_reasoning_trace": {
    "reasoning": "用户今天心情不好，想找人倾诉。我应该表现出共情，但不要过度安慰，给他一个倾诉的空间。",
    "enabled": true
  }
}
```

### Generator 的 Prompt
```python
full_prompt = f"""{system_prompt}

用户消息：
{user_content}

近期记忆：
{memories}

直觉判断（仅参考）：
{intuition}

内心思考（仅参考）：
{reasoning.get('reasoning', '')}  ← 来自 Reasoner

风格要求：
{style}

请直接输出一条回复（不要复述指令）。"""
```

**输出示例**：
```json
{
  "draft_response": "听起来你今天确实不太好受。想聊聊发生了什么吗？我在这听着。"
}
```

## 🎨 类比理解

### 人类对话过程
1. **Reasoner** = 大脑思考
   - "他今天心情不好，我应该..."
   
2. **Generator** = 嘴巴说话
   - "听起来你今天确实不太好受..."

### 写作过程
1. **Reasoner** = 列大纲/写草稿思路
   - "这篇文章应该先讲问题，再讲解决方案..."
   
2. **Generator** = 正式写作
   - "首先，让我们来看看这个问题的本质..."

## 📝 总结

- **Reasoner**：**思考层**，分析意图，制定策略，输出思考内容（不输出给用户）
- **Generator**：**表达层**，根据思考结果，生成实际回复文本（用户会看到）

两者配合，实现了"先思考，再表达"的拟人化对话流程。
