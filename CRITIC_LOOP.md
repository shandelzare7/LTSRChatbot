# Criticï¼ˆæ£€æŸ¥å‘˜ï¼‰èŠ‚ç‚¹å’Œå¾ªç¯æµç¨‹

## ğŸ”„ æ–°çš„æµç¨‹å›¾ï¼ˆå¸¦å¾ªç¯ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¼€å§‹ (ç”¨æˆ·å‘é€æ¶ˆæ¯)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  safety_check â”‚  â† å®‰å…¨æ£€æµ‹èŠ‚ç‚¹
                    â”‚  (å®‰å…¨æ£€æµ‹)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ æ£€æŸ¥ safety_flag
                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                               â”‚
            â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ safety_flag   â”‚              â”‚ safety_flag  â”‚
    â”‚   = True      â”‚              â”‚   = False   â”‚
    â”‚  (å®‰å…¨é€šè¿‡)    â”‚              â”‚  (ä¸å®‰å…¨)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                               â”‚
            â”‚                               â”‚
            â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   planner     â”‚              â”‚     END      â”‚
    â”‚   (è§„åˆ’å™¨)     â”‚              â”‚   (ç»“æŸ)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ ç”Ÿæˆ plan ç­–ç•¥
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   generator   â”‚  â† ç”Ÿæˆå›å¤
    â”‚   (ç”Ÿæˆå™¨)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ ç”Ÿæˆ final_response
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    critic     â”‚  â† ğŸ†• æ£€æŸ¥å‘˜èŠ‚ç‚¹
    â”‚   (æ£€æŸ¥å‘˜)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ æ£€æŸ¥å›å¤è´¨é‡
            â”‚
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                â”‚
    â”‚                â”‚
    â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥é€šè¿‡? â”‚    â”‚ æ£€æŸ¥æœªé€šè¿‡ â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                â”‚
     â”‚                â”‚
     â”‚                â”‚
     â”‚                â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â”‚                â”‚  â•‘    ğŸ”„ å¾ªç¯ï¼      â•‘
     â”‚                â”‚  â•‘  å›åˆ° generator   â•‘
     â”‚                â””â”€â”€â•‘  é‡æ–°ç”Ÿæˆ         â•‘
     â”‚                   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â”‚                           â”‚
     â”‚                           â”‚
     â”‚                           â–¼
     â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                   â”‚   generator   â”‚
     â”‚                   â”‚   (é‡æ–°ç”Ÿæˆ)    â”‚
     â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                           â”‚
     â”‚                           â”‚
     â”‚                           â–¼
     â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                   â”‚    critic     â”‚
     â”‚                   â”‚   (å†æ¬¡æ£€æŸ¥)   â”‚
     â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                           â”‚
     â”‚                           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ æ£€æŸ¥é€šè¿‡
                                 â”‚
                                 â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    evolver    â”‚
                        â”‚   (æ¼”åŒ–å™¨)     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ æ›´æ–°å…³ç³»ç»Ÿè®¡
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚     END       â”‚
                        â”‚   (ç»“æŸ)       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ å…³é”®ç‚¹ï¼šå¾ªç¯ç»“æ„

**å¾ªç¯è·¯å¾„**ï¼š
```
generator â†’ critic â†’ [æ£€æŸ¥æœªé€šè¿‡] â†’ generator (å¾ªç¯)
                â†“
          [æ£€æŸ¥é€šè¿‡] â†’ evolver â†’ END
```

è¿™å°±æ˜¯ä½ çœ‹åˆ°çš„"åœˆ"ï¼ğŸ”

## ğŸ“ ä»£ç å®ç°

### 1. æ·»åŠ  Critic èŠ‚ç‚¹

```python
def critic(state: AgentState) -> AgentState:
    """æ£€æŸ¥å‘˜èŠ‚ç‚¹ï¼šæ£€æŸ¥ç”Ÿæˆçš„å›å¤è´¨é‡"""
    final_response = state.get("final_response", "")
    retry_count = state.get("retry_count", 0)
    
    # æ£€æŸ¥é€»è¾‘
    if retry_count < 2 and len(final_response) < 50:
        # æ£€æŸ¥æœªé€šè¿‡
        return {**state, "critic_feedback": "æ£€æŸ¥å‘ç°é—®é¢˜..."}
    else:
        # æ£€æŸ¥é€šè¿‡
        return {**state, "critic_feedback": "æ£€æŸ¥é€šè¿‡"}
```

### 2. æ¡ä»¶åˆ¤æ–­å‡½æ•°

```python
def should_retry(state: AgentState) -> Literal["retry", "continue"]:
    """å†³å®šæ˜¯å¦éœ€è¦é‡è¯•"""
    critic_feedback = state.get("critic_feedback", "")
    retry_count = state.get("retry_count", 0)
    max_retries = 3
    
    if "æ£€æŸ¥å‘ç°é—®é¢˜" in critic_feedback and retry_count < max_retries:
        return "retry"  # é‡è¯• â†’ å›åˆ° generator
    else:
        return "continue"  # ç»§ç»­ â†’ åˆ° evolver
```

### 3. æ„å»ºå¾ªç¯

```python
# generator -> critic
workflow.add_edge("generator", "critic")

# critic çš„æ¡ä»¶è¾¹ï¼šå½¢æˆå¾ªç¯ï¼
workflow.add_conditional_edges(
    "critic",
    should_retry,
    {
        "retry": "generator",    # å¾ªç¯å›å»ï¼
        "continue": "evolver"    # ç»§ç»­å‰è¿›
    }
)
```

## ğŸ” å®é™…è¿è¡Œç¤ºä¾‹

```
[ç”Ÿæˆå™¨] ç”Ÿæˆå›å¤: ä½ å¥½ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ...
[æ£€æŸ¥å‘˜] âŒ æ£€æŸ¥æœªé€šè¿‡
[æ£€æŸ¥å‘˜] åé¦ˆ: å›å¤è´¨é‡ä¸å¤Ÿï¼Œéœ€è¦æ›´ä¸°å¯Œçš„å†…å®¹
[æ¡ä»¶åˆ¤æ–­] æ£€æŸ¥æœªé€šè¿‡ï¼Œéœ€è¦é‡è¯•ï¼ˆå½“å‰é‡è¯•æ¬¡æ•°: 1/3ï¼‰
[ç”Ÿæˆå™¨] ğŸ”„ æ ¹æ®æ£€æŸ¥å‘˜åé¦ˆé‡æ–°ç”Ÿæˆï¼ˆç¬¬ 2 æ¬¡å°è¯•ï¼‰
[ç”Ÿæˆå™¨] ç”Ÿæˆå›å¤: ä½ å¥½ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ...æˆ‘ä¼šè®¤çœŸå€¾å¬å¹¶å°½åŠ›å¸®åŠ©ä½ ã€‚
[æ£€æŸ¥å‘˜] âœ… æ£€æŸ¥é€šè¿‡
[æ¡ä»¶åˆ¤æ–­] æ£€æŸ¥é€šè¿‡ï¼Œç»§ç»­æµç¨‹
[æ¼”åŒ–å™¨] æ›´æ–°å…³ç³»ç»Ÿè®¡...
```

## ğŸ›¡ï¸ é˜²æ­¢æ— é™å¾ªç¯

é€šè¿‡ `retry_count` å’Œ `max_retries` é™åˆ¶ï¼š

```python
max_retries = 3  # æœ€å¤šé‡è¯• 3 æ¬¡

if retry_count >= max_retries:
    # å³ä½¿æ£€æŸ¥æœªé€šè¿‡ï¼Œä¹Ÿç»§ç»­æµç¨‹ï¼Œé¿å…æ— é™å¾ªç¯
    return "continue"
```

## ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å¾ªç¯ï¼Ÿ

1. **è´¨é‡ä¿è¯**ï¼šç¡®ä¿ç”Ÿæˆçš„å›å¤è¾¾åˆ°æ ‡å‡†
2. **è‡ªæˆ‘æ”¹è¿›**ï¼šæ ¹æ®åé¦ˆä¸æ–­ä¼˜åŒ–
3. **å®¹é”™æ€§**ï¼šå…è®¸å¤±è´¥åé‡è¯•

## ğŸ“ LangGraph å¾ªç¯çš„ä¼˜åŠ¿

- âœ… **è‡ªåŠ¨ç®¡ç†**ï¼šLangGraph è‡ªåŠ¨å¤„ç†å¾ªç¯é€»è¾‘
- âœ… **çŠ¶æ€ä¿æŒ**ï¼šæ¯æ¬¡å¾ªç¯éƒ½èƒ½è®¿é—®å®Œæ•´çš„çŠ¶æ€
- âœ… **æ¡ä»¶æ§åˆ¶**ï¼šå¯ä»¥æ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦ç»§ç»­å¾ªç¯
- âœ… **å¯è§†åŒ–**ï¼šæµç¨‹æ¸…æ™°ï¼Œå®¹æ˜“ç†è§£

è¿™å°±æ˜¯ LangGraph çš„å¼ºå¤§ä¹‹å¤„ï¼š**ç”¨ä»£ç ç”»å‡ºå¸¦å¾ªç¯çš„æµç¨‹å›¾**ï¼
