# Web 应用日志记录说明

## ✅ 日志功能已启用

现在通过分享链接进行的对话会自动记录到日志文件中！

## 📁 日志文件位置

所有 Web 对话日志保存在 `logs/` 目录下，文件名格式：
```
web_chat_{时间戳}_{session_id前8位}.log
```

例如：
- `web_chat_2026-02-11_20-15-30_a1b2c3d4.log`

## 📝 日志内容

每个日志文件包含：

1. **会话信息**（文件开头）：
   - 会话ID
   - 用户ID
   - Bot ID
   - 开始时间

2. **每次对话**：
   - 用户消息（带时间戳）
   - Graph 运行过程的详细日志（Detection、Reasoner、LATS 等所有节点的输出）
   - Bot 回复（带时间戳）

3. **格式**：
   ```
   [2026-02-11T20:15:30.123456] === 用户: 你好
   --------------------------------------------------------------------------------
   [Graph 运行过程的详细日志...]
   --------------------------------------------------------------------------------
   [2026-02-11T20:15:35.789012] === Bot: 你好！很高兴认识你...
   ================================================================================
   ```

## 🔍 查看日志

### 查看最新的 Web 对话日志

```bash
ls -lt logs/web_chat_*.log | head -1
```

### 查看特定会话的日志

```bash
# 根据 session_id 查找
grep -l "会话ID: your_session_id" logs/web_chat_*.log
```

### 实时查看日志

```bash
tail -f logs/web_chat_*.log
```

## ⚙️ 日志管理

- **自动创建**：每次新会话会自动创建新的日志文件
- **持续记录**：同一会话的所有对话都记录在同一个文件中
- **详细程度**：包含 graph 运行的所有详细过程（与控制台版本相同）

## 🔄 重启服务后

如果重启了 FastAPI 服务：
- 新的会话会创建新的日志文件
- 旧的日志文件会保留在 `logs/` 目录中
- 不会覆盖之前的日志

## 📊 日志文件示例

```
================================================================================
EmotionalChatBot V5.0 Web 对话日志
================================================================================
会话ID: a1b2c3d4-e5f6-7890-abcd-ef1234567890
用户ID: web_user_abc123
Bot ID: 4d803b5a-cb30-4d14-89eb-88d259564610
开始时间: 2026-02-11T20:15:30.123456
================================================================================

[2026-02-11T20:15:30.123456] === 用户: 你好
--------------------------------------------------------------------------------
[Graph 运行过程的详细日志...]
[Detection] ...
[Reasoner] ...
[LATS] ...
...
--------------------------------------------------------------------------------
[2026-02-11T20:15:35.789012] === Bot: 你好！很高兴认识你...
================================================================================
```

## 💡 提示

1. **日志文件命名**：使用时间戳和 session_id 前8位，便于识别
2. **日志保留**：日志文件会一直保留，不会自动删除
3. **日志大小**：每次对话都会记录 graph 的完整运行过程，文件可能较大
4. **性能影响**：日志记录是异步的，不会影响响应速度
