databases:
  - name: ltsrchatbot-db
    region: singapore
    plan: starter
    databaseName: ltsrchatbot_v5
    user: ltsrchatbot

services:
  - type: web
    name: ltsrchatbot-web
    env: python
    region: singapore
    plan: starter
    autoDeploy: true

    buildCommand: pip install -r EmotionalChatBot_V5/requirements.txt
    startCommand: bash EmotionalChatBot_V5/render_start.sh

    envVars:
      - key: PYTHONUNBUFFERED
        value: "1"
      # Render default (new services) is Python 3.14.x which currently breaks parts of LangChain/Pydantic.
      # Pin to a stable version.
      - key: PYTHON_VERSION
        value: "3.12.7"
      - key: ENVIRONMENT
        value: production

      # Inject Render Postgres URL (often starts with `postgres://...`)
      # Code normalizes it to `postgresql+asyncpg://...` and handles sslmode best-effort.
      - key: DATABASE_URL
        fromDatabase:
          name: ltsrchatbot-db
          property: connectionString

      # LLM config (set these in Render dashboard after deploy)
      - key: OPENAI_API_KEY
        sync: false
      - key: OPENAI_BASE_URL
        sync: false
      - key: OPENAI_MODEL
        value: gpt-4o

      # Optional (uncomment in Render UI if you want perf traces)
      # - key: LTSR_LLM_PERF
      #   value: "1"
      # - key: LTSR_HTTP_TRACE
      #   value: "1"

